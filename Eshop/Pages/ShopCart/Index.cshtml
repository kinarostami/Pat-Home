@page "{handler?}"
@using Common.Application
@model Eshop.Pages.ShopCart.IndexModel
@{
    ViewData["title"] = "سبد خرید";
    ViewData["selected"] = "shopCart";
}
@section Header
{
    <partial name="Shared/SideBar/_SideBar" model="true" />
}
@if (Model.IsChanged)
{
    <div class="alert alert-danger">
        <i class="fa fa-warning"></i>
        <small>سبد خرید شما بروز رسانی شده است ، قبلا پرداخت حتما آن را بازبینی کنید</small>
    </div>
}

@if (Model.Order != null && Model.Order.Details.Any())
{
    <div class="container">
        <div class="cart-wrapper-area py-3">
            <div class="cart-table card mb-3">
                <div class="table-responsive card-body">
                    <table class="table mb-0">
                        <tbody>

                            @foreach (var detail in Model.Order.Details)
                            {
                                var id = $"inputCounter{detail.Id}";
                                var url = $"/Product/{detail.Product.Id}/{detail.Product.ProductTitle.Trim().Replace(" ", "-")}";
                                <tr>
                                    <th style="width: 10px">
                                        <a class="remove-product" href="#" onclick="deleteItemFromShopCart(@detail.Id)">
                                            <i class="lni lni-close"></i>
                                        </a>
                                    </th>
                                    <td>
                                        <a target="_blank" href="@url">
                                            @detail.Product.ProductTitle @detail.GetWeight()
                                        </a>
                                        <span class="d-block">@detail.TotalPrice.TooMan()</span>

                                    </td>
                                    @if (User.Identity.IsAuthenticated)
                                    {
                                        <td style="width: 10px">
                                            <form id="shopCartForm" class="cart-form" onsubmit="AddToShopCart(event)">
                                                <div class="order-plus-minus d-flex align-items-center">
                                                    <div class="quantity-button-handler" onclick="minus(@detail.Id)">-</div>
                                                    <input class="form-control cart-quantity-input item-counter" id="@id" disabled="" type="text" min="1" step="1" name="count" value="@detail.Count">
                                                    <div class="quantity-button-handler" onclick="plus(@detail.Id)">+</div>
                                                </div>
                                            </form>
                                        </td>
                                    }
                                    else
                                    {
                                        <td style="width: 100px">
                                            <form id="shopCartForm" class="cart-form" onsubmit="AddToShopCart(event)">
                                                <div class="order-plus-minus d-flex align-items-center">
                                                    <input class="form-control cart-quantity-input item-counter" id="@id" disabled="" type="text" min="1" step="1" name="count" value="@detail.Count">
                                                </div>
                                            </form>
                                        </td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card cart-amount-area">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <h5 class="total-price mb-0">
                        <span class="counter">@Model.Order.Price.ToString("#,0")</span> تومان
                    </h5>
                    <a class="btn btn-warning" href="/CheckOut">پرداخت </a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="card coupon-card mb-3">
        <div class="card-body">
            <div class="alert alert-warning w-100">
                <small>سبد خرید شما خالی است !</small>
            </div>
            <a href="/" class="btn btn-warning">بازگشت به خانه</a>
        </div>
    </div>
}
